<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Steeve</title>
    <link rel="stylesheet" type="text/css" href="style.css">
	<script>
		document.addEventListener('DOMContentLoaded',initInfos);

		//let botListElt;
		//let brainListElt;
		//let addNewBotButton;
		//let talkBotButton;
		//let chooseBot;
		//let mouthListElt;
        let infoListElt;

        function initInfos(){
            //let chooseMouth;

			//chooseMouth = document.getElementById("chooseMouth");
			infoListElt = document.getElementById("infoListSELECT");
			reloadBotInfos();
        }

        function reloadBotInfos(){
            //first, clean up
			console.log("Je reload la liste des infos");
			while (infoListElt.firstChild) {
  				infoListElt.removeChild(infoListElt.firstChild);
			}
            let myHeaders = new Headers();
			myHeaders.append('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
			myHeaders.append('Accept', 'application/json');
			myHeaders.append('Set-Cookie', 'passPhrase=Hop');

			let myInit = { 
				method: 'GET',
               	headers: myHeaders,
               	credentials: 'same-origin',
               	mode: 'cors',
               	cache: 'no-store' 
            };

            let myURL = `http://localhost:3001/bot/3011`;

            fetch(myURL,myInit)
				.then((httpResponse)=>{
					for (let field of httpResponse.headers) {
						//console.log(`raw = ${field}`);
					}
					return httpResponse.json()
				})
				.then((setOfInfos)=>{
                    console.log(setOfInfos);
					for(let info of setOfInfos){
						console.log(setOfInfos);
                        let item = document.createElement("option");
                        item.setAttribute("value", info.name);
                        item.setAttribute("value", info.brain);
                        item.innerHTML += `Id et port : 3011 `;
                        item.innerHTML += `Nom : ${info.name} \n`;
                        item.innerHTML += `Cerveaux : ${info.brain} \n`;
                        infoListElt.appendChild(item);
                        console.log(infoListElt);
					}
				})
				.catch((err)=>{
					console.log(`ERROR : ${err} ${err.stack}`);
				})
        }
		function initBots(){
			botListElt = document.getElementById("botListSELECT");

			//DECOMMENTER LORSQUE LES CLASSES DES BOTS ET BRAINS SONT TERMINEES
			reloadBotList();
			//reloadMouthList();
			//reloadBrainList();

			//newTaskButton = document.getElementById("newTaskButton");
			//newTaskButton.addEventListener("click",()=>{modal.style.display = "block";});
			//addNewTaskButton = document.getElementById("addNewTaskButton");
			//addNewTaskButton.addEventListener("click",createNewTask);
			//chooseBot = document.getElementById("chooseBot");
			talkBotButton = document.getElementById("talkBotButton");
			talkBotButton.addEventListener("click",talkingbot);

			
		}
		function reloadBotList(){ //met à jour la liste de tous les bots
			//first, clean up
			console.log("Je reload la liste des bots");
			while (botListElt.firstChild) {
  				botListElt.removeChild(botListElt.firstChild);
			}
			let myHeaders = new Headers();
			myHeaders.append('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
			myHeaders.append('Accept', 'application/json');
			myHeaders.append('Set-Cookie', 'passPhrase=Hop');

			let myInit = { 
				method: 'GET',
               	headers: myHeaders,
               	credentials: 'same-origin',
               	mode: 'cors',
               	cache: 'no-store' 
            };

			let myURL = `http://localhost:3001/bot`;
			
			fetch(myURL,myInit)
				.then((httpResponse)=>{
					for (let field of httpResponse.headers) {
						console.log(`raw = ${field}`);
					}
					return httpResponse.json()
				})
				.then((setOfBots)=>{
					for(let bot of setOfBots){
						let item = document.createElement("option");
						item.setAttribute("value", bot.name);
						item.innerHTML += ` ${bot.name}`;
						botListElt.appendChild(item);
					}
				})
				.catch((err)=>{
					console.log(`ERROR : ${err} ${err.stack}`);
				})
		}

		//document.addEventListener('DOMContentLoaded', initMouth);

		function initMouth(){
			//let chooseMouth;

			//chooseMouth = document.getElementById("chooseMouth");
			mouthListElt = document.getElementById("mouthListSELECT");
			reloadMouthList();
		}
		
		function reloadBrainList(){
                //first, clean up
                console.log("Je reload la liste des brains");
            while (brainListElt.firstChild) {
                brainListElt.removeChild(brainListElt.firstChild);
            }
            let myHeaders = new Headers();
            myHeaders.append('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            myHeaders.append('Accept', 'application/json');
            myHeaders.append('Set-Cookie', 'passPhrase=Hop');

            let myInit = { 
                method: 'GET',
                headers: myHeaders,
                credentials: 'same-origin',
                mode: 'cors',
                cache: 'no-store' 
            };

            let myURL = `http://localhost:3003/brain`;
            
            fetch(myURL,myInit)
                .then((httpResponse)=>{
                    for (let field of httpResponse.headers) {
                        console.log(`raw = ${field}`);
                    }
                    return httpResponse.json()
                })
                .then((setOfBrains)=>{
                    for(let brain of setOfBrains){
                        let item = document.createElement("option");
                        item.setAttribute("value", brain.name);
                        item.innerHTML += ` ${brain.name}`;
                        brainListElt.appendChild(item);
                    }
                })
                .catch((err)=>{
                    console.log(`ERROR : ${err} ${err.stack}`);
                })
		}

		function reloadMouthList(){
			//first, clean up
			while (mouthListElt.firstChild) {
  				mouthListElt.removeChild(mouthListElt.firstChild);
			}
			let myHeaders = new Headers();
			myHeaders.append('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
			myHeaders.append('Accept', 'application/json');
			myHeaders.append('Set-Cookie', 'passPhrase=Hop');

			let myInit = { 
				method: 'GET',
               	headers: myHeaders,
               	credentials: 'same-origin',
               	mode: 'cors',
               	cache: 'no-store' 
            };

			let myURL = `http://localhost:3002/mouth`;
			
			fetch(myURL,myInit)
				.then((httpResponse)=>{
					return httpResponse.json()
				})
				.then((setOfMouths)=>{
					for(let mouth of setOfMouths){
						console.log(setOfMouths);
						let item = document.createElement("option");
						item.setAttribute("value", mouth.name);
						item.innerHTML += ` ${mouth.name}`;
						mouthListElt.appendChild(item);
						console.log(mouthListElt);
					}
				})
				.catch((err)=>{
					console.log(`ERROR : ${err}${err.stack}`);
				})
		}

		/*function talkingbot(){
			let mouthSelected = mouthListElt.value;

			if (mouthSelected == 'Socket'){
				window.open('http://localhost:3002/socketio/', '_blank');
				//window.open('http://localhost:3001/bot/', '_blank');
				//normalement faudrait faire un GET... ça arrive
			}

			if (mouthSelected == 'Discord'){
				window.open('https://discord.gg/FyKz3kajW7', '_blank');
			}
		}*/ 

        function createItem(bot){
			let item = document.createElement("li");
			
			// Adding a DELETE Button
			/*let delBtn = document.createElement("button");
			delBtn.innerHTML = "DELETE";
			let id = `del_${task.id}`;
			
			delBtn.setAttribute("id",id);
			delBtn.setAttribute("onclick",`deleteTask(${task.id})`);
			//delBtn.addEventListener("click",()=>{deleteTask(task.id)});
			item.appendChild(delBtn);*/


			// Adding a PUT Button
			/*let putBtn = document.createElement("button");
			putBtn.innerHTML = "PUT";
			putBtn.setAttribute("onclick",`replaceTask(${task.id})`);
			//putBtn.addEventListener("click",()=>{replaceTask(task.id)});
			item.appendChild(putBtn);*/
			
			// Adding a PATCH Button
			let patchBtn = document.createElement("button");
			patchBtn.innerHTML = "PATCH";
			patchBtn.setAttribute("onclick",`updateBrain(${bot.id})`);
			patchBtn.addEventListener("click",()=>{updateBrain(bot.id)});
			item.appendChild(patchBtn);

			item.innerHTML += ` ${bot.title}(asssigned to ${bot.assignement.personId} )`;
			return item;
		}

        function updateBrain(botId){
			console.log(`updating bot brain with Id ${botId}`);
			//TODO
			//Obvioulsly, you will need to launch a modal
		}
	</script>
</head>
<body>

    <header>
        <h1>Steeve</h1>
    </header>

	<ul id="infoListSELECT">
	</ul>

    <button id="retour" onclick=window.location.href="http://localhost:3001/botV2";>RETOUR</button>

</body>
<footer>
    <p>©Copyright GODIN Karole & CLAUDE Sarah </p>
</footer>
</html>